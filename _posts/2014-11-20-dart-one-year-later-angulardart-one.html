---
layout: post
title: ! 'Dart one year later : AngularDart one week later'
date: '2014-11-20T14:27:00.001-08:00'
author: Adam Wo≈Çk
tags:
- programming
- dart
- polymer
- angular
modified_time: '2014-11-20T14:27:56.781-08:00'
blogger_id: tag:blogger.com,1999:blog-7611594305180455830.post-5669131067907833754
blogger_orig_url: http://homing-on-code.blogspot.com/2014/11/dart-one-year-later-angulardart-one.html
---

<div style="text-align: left;">Looking at my commit history I realized that a week has past since I started evaluating angular dart for <a href="https://koparo.com/">koparo.com</a>. This is also the day that I decided we won't go forward with angular or polymer for that matter for the foreseeable future.</div><br />The good, the bad &amp; the ugly is the subject of this post. If you want to get an insight to why we are backing out read on - we will also probably stick to dart itself.<br /><blockquote class="tr_bq">changeset: &nbsp; 0:394d16883231<br />user: &nbsp; &nbsp; &nbsp; &nbsp;Adam Wolk &lt;adam.wolk@koparo.com&gt;<br />date: &nbsp; &nbsp; &nbsp; &nbsp;Wed Nov 12 14:59:34 2014 +0100<br />summary: &nbsp; &nbsp; Initial commit</blockquote><br /><a name='more'></a><h3>Epilogue</h3><div>History tends to repeat itself. Initially I tried out Dart for Koparo a year ago (+ 1 week). There was no Angular in sight yet so the choice back then was Polymer.</div><div><br /></div><br /><blockquote class="tr_bq">commit 9f45b614423f7be24ffcc878209de6200e09892e<br />Author: mulander &lt;netprobe@gmail.com&gt;<br />Date: &nbsp; Fri Nov 29 20:45:15 2013 +0100<br />&nbsp; &nbsp; Case 763 Initial commit<br />&nbsp; &nbsp;<br />&nbsp; &nbsp; This commit includes the project generated by Dart Editor by<br />&nbsp; &nbsp; default for a new polymer based web application in Dart.<br />&nbsp; &nbsp;<br />&nbsp; &nbsp; Polymer is a Dart library that allows bi-directional communication<br />&nbsp; &nbsp; between HTML DOM and Dart code by defining new HTML tags.</blockquote><div>Back then everything felt in flux. It was not clear for me what the Dart team wanted the community to use. WebUI was still a first class citizen without the big warning that it's 'deprecated' being presented on it's documentation page.</div><div><br /></div><div>Polymer itself felt under-documented, buggy &amp; under heavy development. No fault there we knew that the language is extremely young and didn't expect a mature Web ecosystem.</div><div><br /></div><div>Now, a year later with AngularDart 1.0 out the door we felt it's a good time to re-evaluate our options.</div><br /><h3>The good</h3><div>Let's start with Dart first. I love the concept of the language and revisiting the app written a year ago was a great feeling compared to our current javascript stack. It reminds me a lot of smalltalk and that's not a big surprise considering the background of some of the main developers of the language.</div><div><br /></div><div>The Dart Editor got better. Less crashes all around and mostly just <a href="https://code.google.com/p/dart/issues/detail?id=21549">one issue</a> that got reported by us upstream and fixed in 3 days.</div><div><br /></div><div>We had the bad luck of starting the AngularDart evaluation while the <a href="https://github.com/angular/angular.dart.tutorial">angular.dart.tutorial</a> was still out of date but fortunately it was already updated a few days later allowing us to move forward without hunting for the required changes in the framework.</div><div><br /></div><div>So what was great?</div><div><ul><li>Template binding of course which we also loved in Polymer over an year ago</li><li>More structure to the application (routes, components, services)</li><li>A much cleaner language than javascript</li><li>Greatly reduced dart2js deployment size compared to what was generated in the past</li><li>No issue with using bootstrap this time thanks to Agnulars userShadowDom=false annotation on components</li></ul></div><h3>The bad</h3><div>We unfortunately started hitting issues early in the development cycle. The tutorial of course was flawless in Dartium but as soon as we started to go down our own path we started to hit issues with the existing documentation and additional ones after deployment to our staging area.</div><div><br /></div><div>The first problem we hit was described in my previous blog post about <a href="{{ site.baseurl }}{% post_url 2014-11-12-fixing-pub-build-on-debian %}">fixing pub build on Debian</a>. Since that's mostly a devops issue it didn't deter us from pursuing the setup further.&nbsp;</div><div><br /></div><div>Trucking along we saw minor issues with views not being refreshed on the first visit to the page and the documentation felt lacking to say the least. I'm sure most of the problems is us starting with AngularDart without prior AngularJS experience but still this raised some red flags here &amp; there.</div><div><br /></div><div>The real problems cropped up when I actually tried to deploy and use the code on our staging areas.</div><div>Most of you are aware of <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a>&nbsp;- our backend is currently written in Ruby on Rails and perfectly capable of serving http/json responses. We deliberately wanted a clean slate approach without integrating the new UI with our Rails pipeline so a decision was made to serve the AngularDart UI from a sub location in nginx. The following lightly reflects our current nginx setup:</div><br /><blockquote class="tr_bq">server {<br />&nbsp; &nbsp; &nbsp; listen 80;<br />&nbsp; &nbsp; &nbsp; server_name staging_server;<br />&nbsp; location /newui/ {<br />&nbsp; &nbsp; autoindex off;<br />&nbsp; &nbsp; root /home/webui/newui/build/web;<br />&nbsp; }<br />&nbsp; root /home/webui/staging_server/public;<br />&nbsp; rails_env development;<br />&nbsp; passenger_enabled on;<br />}</blockquote><div>The moment our ansible jobs deployed the most recent change in the AngularDart UI issues popped up. Exceptions that were never hit on Dartium or a local pub build&nbsp;+ serve cropped up in droves. Parts of the app were simply broken with stack traces that were useless.</div><div><br /></div><div>The reason for the problems was serving the application from a different URL then the root URL. We did <a href="https://github.com/angular/angular.dart/issues/1601">report</a> this problem upstream yesterday but didn't heard back on it as of yet.</div><div><br /></div><div>We also hit some additional issues. Failed assertions deep down in the Angular stack that we also reported <a href="https://github.com/angular/angular.dart/issues/1602">here</a>, not to mention plain warnings even in the updated AngularDart tutorial that were reported <a href="https://github.com/angular/angular.dart/issues/1603">here</a>.</div><div><br /></div><div>Unfortunately the #dart freenode channel was only able to help with obtaining the Dart stack traces for those issues but not resolving them which is an additional concern. The below redacted transcript perfectly illustrates the issue. People <b>are</b>&nbsp;helpful and I do greatly appreciate it but everything seems to be spread a bit too much so you're most likely the first person to encounter a particular problem.</div><blockquote class="tr_bq">18:26 &lt;REDACTED&gt; mulander: <b>sorry don't know angular enough</b> to answer that. There must be a root configuration someplace.<br />18:28 &lt;REDACTED&gt; If not you can fake it with the html base tag. Sets the root for relative calls. Its a long shot.<br />18:29 &lt;REDACTED&gt; Relative urls*<br />18:31 &lt;REDACTED&gt; mulander: also try and build you project and see if the built version has the same issue. Angulars dependency injection code is different on built code.<br />18:31 &lt;mulander&gt; the testing I've done was with pub build<br />18:32 &lt;mulander&gt; and deployed both with nginx and a local small test server in go to confirm that the issue is the suffix url<br />18:32 &lt;mulander&gt; it's funny because more than half of the code works<br />18:32 &lt;mulander&gt; ie. the router picks up path changes and redirects to correct views<br />18:32 &lt;mulander&gt; but some parts just blow up with exceptions that are inllegible since they are dart2js compiled<br />18:33 &lt;REDACTED&gt; How do the the setup work if you connect wit dartium.<br />18:34 &lt;REDACTED&gt; You may get better error message at least. If not you have found a rare js only bug.<br />18:34 &lt;REDACTED&gt; I am not going to lie <b>they are a pain</b>.</blockquote><h3>The ugly</h3><div>All of the above brings us to the ugly part. I really wanted to find solutions for the issues we hit. First thing that alarmed me was almost no activity in the main angular dart repo where the <a href="https://github.com/angular/angular.dart/commit/0fbd007e0910fe421a9dc8b84da2ea92b2c7b768">last commit</a> was almost a month ago on Halloween.</div><div><br /></div><div>I started going through the mailing lists and hit some interesting posts - most notatbly <a href="https://groups.google.com/forum/#!topic/angular-dart/cbXcHwBcuoM">this one</a>:</div><div><br /></div><blockquote class="tr_bq"><div style="background-color: white; border: 0px; color: #222222; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px; padding: 0px; vertical-align: baseline;">With&nbsp;<a href="http://blog.angulardart.org/2014/10/angulardart-10-has-landed.html" style="border: 0px; color: #6611cc; cursor: pointer; margin: 0px; padding: 0px; text-decoration: none; vertical-align: baseline;" target="_blank">the release of 1.0</a>, we're entering a new phase of development on AngularDart. For the next few months, instead of new features for AngularDart 1.0, <b>the core team is devoting our attention to a working prototype of our next-gen Angular, Angular 2</b>, with the goal of taking the lessons learned from AngularDart and making them available for both AngularJS and AngularDart going forward. Angular 2 is ultimately where we'll make functional improvements like the one you're requesting in 1307. Our hope is that our approach to the next generation of Angular will give us a way to advance both platforms in greater sync.</div><div style="background-color: white; border: 0px; color: #222222; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px; padding: 0px; vertical-align: baseline;"><br /></div><div style="background-color: white; border: 0px; color: #222222; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px; padding: 0px; vertical-align: baseline;">What that means for AngularDart in t<b>he immediate future is that we will only be actively working on issues that are critical to how AngularDart 1.0 behaves</b>. In this case, I closed your issue because -- although not ideal -- there's a reasonable workaround today, and the kind of change you're requesting has a strong probablility of causing breaking changes for others.</div><div style="background-color: white; border: 0px; color: #222222; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px; padding: 0px; vertical-align: baseline;"><br /></div><div style="background-color: white; border: 0px; color: #222222; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px; padding: 0px; vertical-align: baseline;">So if you're using AngularDart 1.0, the good news is that you can expect greater stability and few (ideally no) breaking changes. The bad news is that if you are asking for a new feature or something outside the scope of what already exists in 1.0, you'll have to wait a little while until we can consider it part of the Angular 2 effort.&nbsp;</div></blockquote>&nbsp;That pretty much ruled out AngularDart for us until the development effort settles. During the research we also stumbled on <a href="https://groups.google.com/forum/#!msg/angular-dart/HbZ0HCTUpdk/FD7g7Y5ZmoEJ">this post</a> regarding paper elementst:<br /><br /><blockquote class="tr_bq"><div style="background-color: white; border: 0px; color: #222222; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px; padding: 0px; vertical-align: baseline;">PaperElements are not very stable yet and Dart PaperElements are even less stable.</div><div style="background-color: white; border: 0px; color: #222222; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px; padding: 0px; vertical-align: baseline;">Currently there are known issues with two-way-binding in PaperElements.dart.</div></blockquote>Topped off by the following comment in simple_router.dart from the TodoMV example<br /><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">// A very simple router for TodoMVC. Real app should use package:route, but it</span></blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">// does not currently support Shadow DOM.</span></blockquote></blockquote>All in all. This feels like the Dart team is not yet dedicated to what's the <b>promoted</b>&nbsp;way to develop rich web applications with Dart. The Angular team is off working on a prototype for the <i>next best thing</i>&nbsp;while polymer understandably is in big flux as the area is barely explored.<br /><h3>Prologue</h3><div>Where does this all leave us? Not with Angular or Polymer unfortunately. We still want to stick with Dart as plain javascript - even with frameworks is not something anyone of us wants to dive deep into. Dart showed steady progress &amp; improvements since the last time we tried it. Even if we stumbled upon <a href="https://api.dartlang.org/apidocs/channels/stable/dartdoc-viewer/dart:html.Location">one</a> or more undocumented parts of the standard library - it's still miles better than what AngularDart offers.</div><div><br /></div><div>What we all would really love to see is the Dart team clearly stating what is the preferred way to develop web applications with Dart - currently the platform offers too many incomplete choices that I think hurt mostly the newcomers.</div><div><br /></div><div>We will be watching the Dart landscape closely but for now our focus is to evaluate pure Dart as the way to go forward for us - unless we hit some major issues in the coming week then I don't see a way for Dart itself dropping out of our scope.</div>